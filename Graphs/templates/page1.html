<!DOCTYPE html>
{% load staticfiles %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>GHC</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600">
    <link rel="stylesheet" href="../static/css/css/fontawesome.min.css">
    <link rel="stylesheet" href="../static/css/css/fullcalendar.min.css">
    <link rel="stylesheet" href="../static/css/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/css/tooplate.css">
    <link rel="stylesheet" href="../static/css/css/styling.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Bootstrap CSS -->
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  
</head>
<style>

.leg{
    stroke-width:3px;
}
        .line {
        fill: none;
        /* stroke: steelblue; */
        stroke-width: 2px;
        }
        .axis { font: 13px Verdana;
        }
        #id_of_table
        {


            font-size: 15px;
            line-height: 24px;
            margin-left:10%;
            margin-top:3%;
            /* margin: 10% auto; */
            /* text-align: center; */
        }
        #js-datatable
        {
            width:70% ;
            font-size: 15px;
            line-height: 24px;
            margin-left:5% ;
            /* text-align: center; */
            float:left
        }
        #ytd_table
        {
            float:right;
            width:100px;
            font-size: 15px;
            line-height: 24px;
            margin-top:0px;
        }
        #ytd_table th, #js-datatable th, #id_of_table th {
            border:1px solid black;
            background-color:#9EC8F1;
            font-family:verdana !important;	
            font-weight: normal;
            padding: 10px 15px;
            position: relative;
            text-shadow: 0 1px 0 #000;
            text-align: center;

        }


        td {
            border:1px solid black;
            padding: 10px 15px;
            position: relative;
            transition: all 300ms;
            font-size: 15px;
        }
        .table th
        {
        text-align:left;
        }
        .table td + td,
        .table th + th
        {
        text-align:right
        }

        #id_of_table input[type="text"], textarea {

        border:0px;
        text-align: center;
        }
        #id_of_table input:focus {
        border: 0;
        outline: none
        }

        p{
            font-size:20px;
        }        
        .toolTip {
                position: absolute;
                display: none;
                min-width: 80px;
                height: auto;
                background: none repeat scroll 0 0 #ffffff;
                border: 1px solid #6F257F;
                padding: 14px;
                text-align: center;
                pointer-events: none;
        }
        .legend{
            display:block;
        }
                
        .x_ticks line , .x_ticks path{
            fill: none;
            stroke: none;
            
            }

            
 </style>
<body id="reportsPage" onload="table_data('30/08/2019');document.getElementById('dt').value='30/08/2019';">
    <div class="" id="home">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav class="navbar navbar-expand-xl navbar-light bg-light" style="position: fixed;width:100%;top:0;left:0;z-index:1;">
                        <a class="navbar-brand" href="#">
                            <img src="../static/images/ghclogo.png" height=70 width=70>
                            <h1 class="tm-site-title mb-0">GHC</h1>
                        </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                          </button>
            
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav mx-auto">
                                    <li class="nav-item">
                                            <a class="nav-link " href="{% url 'chatbot'%}"> Chatterbot
                                            </a>
                                        </li>
                                <li class="nav-item">
                                    <a class="nav-link active" href="{% url 'firstpage'%}"> Portfolio Overview
                                        <span class="sr-only">(current)</span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <li class="nav-item">
                                        <a class="nav-link "  href="{% url 'secondpage'%}">Net Exposure
                                           
                                        </a>
                                    </li>
                                   
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="{% url 'thirdpage'%}">Factor Contribution</a>
                                </li>

                                <li class="nav-item">
                                    <a class="nav-link"  href="{% url 'fourthpage'%}"> Gross Exposure and PnL</a>
                                </li>
                                <li class="nav-item ">
                                    <a class="nav-link"  href="{% url 'fifthpage'%}">Value at Risk</a>
                    
                                </li>
                                <li class="nav-item ">
                                    <a class="nav-link" href="{% url 'sixthpage'%}">Excess, Vol and Return Disturbution</a>
                    
                                </li>
                            </ul>
                            <ul class="navbar-nav">
                                <li class="nav-item">
                                    <a class="nav-link d-flex" href="{% url 'logout'%}">
                                        <!-- <i class="far fa-user mr-2 tm-logout-icon"></i> -->
                                        <span>Logout<i style="font-size:24px" class="fa">&#xf08b;</i></span>
                            
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </nav> 
                </div>
            </div>
            <!-- row -->
            <div class="row tm-content-row tm-mt-big" style="margin-top:100px">
                <div class="tm-col tm-col-big">
                    <div class="bg-white tm-block h-100 centered " id="centered">
                        <h2 class="tm-block-title"> Growth of $1000-Since Inception</h2>
                        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.5.0/d3.min.js"></script>
                        <!-- <svg style="width:100%;height:100%" class="centered"  id="centered"></svg> -->
                        <script src="https://d3js.org/d3.v4.min.js"></script>
                        <script>
                            
                            // // set the dimensions and margins of the graph
                            var margin = {top: 40, right: 20, bottom: 30, left: 90},
                                width = 650,
                                height =300;
                            

                            var tooltip1 = d3.select("#centered").append("div").attr("class", "toolTip");
                            var tooltip2 = d3.select("#centered").append("div").attr("class", "toolTip");
                            // parse the date / time
                            // var parseTime = d3.timeParse("%Y-%m");
                            var parseTime = d3.timeParse("%Y-%m-%d");
                            var formatTime = d3.timeFormat("%b %d %Y");
                            // set the ranges
                            var x = d3.scaleTime().range([0, width]);
                            var y = d3.scaleLinear().range([height, 0]);
                            // var x= d3.scaleTime()
                            //     .domain([new Date(2014, 0, 1), new Date(2016, 0, 1, 0)])
                            //     .rangeRound([20,width - 20]).nice();
                            //     var xAxis2 = d3.axisBottom(x).tickFormat(d3.timeFormat("%y"));
                
                            // define the 1st line
                            var valueline = d3.line()
                                .x(function(d) { return x(d.Trade_Dt); })
                                .y(function(d) { return y(d.Fund_Cumulative); });
                            
                            // define the 2nd line
                            var valueline2 = d3.line()
                                .x(function(d) { return x(d.Trade_Dt); })
                                .y(function(d) { return y(d.Cumulative_Return_Benchmark); });
                            
                            // append the svg obgect to the body of the page
                            // appends a 'group' element to 'svg'
                            // moves the 'group' element to the top left margin
                            var svg = d3.select("#centered").append("svg")
                                        .attr("viewBox", [0, 0, width+100, height+100])
                                        .append("g")
                                        .attr("transform",
                                                "translate(" + margin.left + "," + margin.top + ")");
                
                            // Get the data
                            var count=0
                            var data={{data.chart_data|safe}}
                            var count=[]
                                // format the data
                                data.forEach(function(d) {
                                    d.Trade_Dt = parseTime(d.Trade_Dt);
                                    
                                    count.push(d.Trade_Dt.getFullYear())
                                    d.Fund_Cumulative= +d.Fund_Cumulative;
                                    d.Cumulative_Return_Benchmark = +d.Cumulative_Return_Benchmark;
                                    
                                });
                            
                            count = count.filter( function( item, index, inputArray ) {
                                        return inputArray.indexOf(item) == index;
                                });
                            
                            
                                // Scale the range of the data
                            
                                x.domain([d3.min(data, function(d) {return Math.min(d.Trade_Dt); }),d3.max(data, function(d) {return Math.max(d.Trade_Dt); })]);
                                
                                // y.domain([1000, d3.max(data, function(d) {return Math.max(d.Fund_Cumulative, d.Cumulative_Return_Benchmark); })]).nice();

                                y.domain([1000, 1600]);
                            // Add the valueline path.
                            svg.append("path")
                                .data([data])
                                .attr("class", "line")
                                .style("stroke", "#44A9A8")
                                .attr("d", valueline);
                                svg.selectAll("dot")
                                .data(data)
                                .enter().append("circle")
                                .attr("r", 2)
                                .style("fill", "transparent")  
                                .attr("cx", function(d) { return x(d.Trade_Dt); })
                                .attr("cy", function(d) { return y(d.Fund_Cumulative)}) 
                                .on("mouseover", function(d){
                                    tooltip1.transition()		
                                    .duration(200)		
                                            .style("left", d3.event.pageX - 50 + "px")
                                            .style("top", d3.event.pageY - 100 + "px")
                                            .style("display", "inline-block")   
                                            tooltip1.html("Date : "+formatTime(d.Trade_Dt)+ "<br/>Fund : $"  + d.Fund_Cumulative.toFixed(2) +"<br/>Benchmark : $"  + d.Cumulative_Return_Benchmark.toFixed(2));

                                      })
                                      .on("mouseout", function(){
                                    tooltip1.style("display","none")
                                });
                            
                                 
                            
                        
                            // Add the valueline2 path.
                            svg.append("path")
                                .data([data])
                                .attr("class", "line")
                                .style("stroke", "#5C5C61")
                                .attr("d", valueline2)
                                svg.selectAll("dot")
                                .data(data)
                                .enter().append("circle")
                                .attr("r", 2)
                                .attr("cx", function(d) { return x(d.Trade_Dt); })
                                .attr("cy", function(d) { return y(d.Cumulative_Return_Benchmark); })   
                                .style("fill", "transparent")   
                                .on("mouseover", function(d){
                                    tooltip1.transition()		
                                    .duration(200)		
                                            .style("left", d3.event.pageX - 50 + "px")
                                            .style("top", d3.event.pageY - 100 + "px")
                                            .style("display", "inline-block")   
                                            tooltip1.html("Date : "+formatTime(d.Trade_Dt)+ "<br/>Fund : $"  + d.Fund_Cumulative.toFixed(2) +"<br/>Benchmark : $"  + d.Cumulative_Return_Benchmark.toFixed(2));

                                      })
                                      .on("mouseout", function(){
                                    tooltip1.style("display","none")
                                });
                        
                            // Add the X Axis
                            svg.append("g")
                                .attr("transform", "translate(-0," + height + ")").attr("class","axis")
                                .call(d3.axisBottom(x).tickFormat(d3.timeFormat("%b-%y")).tickValues(x.ticks(3).concat(x.domain()))) 
                                .selectAll("text") .attr("transform", "rotate(-40)").attr("y", 0) .style("font-family","verdana")
                                .style("font-size","12")
                                .attr("x", -30)
                                .attr("dy", "1.0em");
                        
                            // Add the Y Axis                        
                            svg.append("g") 
                             .attr("class","axis")
                             .style("font-family","verdana")
                                .style("font-size","12")
                                .call(d3.axisLeft(y).ticks(5).tickFormat(d => "$"+d ));
                        
                
                            svg.append("text")             
                                .attr("x",-150 )
                                .attr("y",-60)
                                .style("text-anchor", "middle")
                                .attr("transform", "rotate(-90)")
                                .style("font-family","verdana")
                                .style("font-size","13")
                                .text("Growth of $1000");

                            var colors = ["#44A9A8", "#5C5C61"];
                  
                            var data = ['Fund','S&P 500'];

                                    var svg2 = d3.select('#centered')
                                    .append('svg')
                                    .attr("viewBox", [0, -10, width, height-250])
                                    
                                    var groups = svg2.selectAll('g')
                                    .data(data)
                                    .enter()
                                    .append('g');
                                    
        
                                    var line=groups.append("line").attr("x1",200).attr("x2",220).attr("y1",5).attr("class","leg")
                                    .attr("y2",5).attr('stroke',function(d,i) { return colors[i];})

                                    var text = groups.append('text')
                                    .attr('y', 10)
                                    .attr('x',230).style("font-size","14px")
                                    .text(function(d) { return d; });
                                    
                                    // Now space the groups out after they have been appended:
                                    var padding = 40;
                                    groups.attr('transform', function(d,i) { 
                                    return "translate("+(d3.sum(data, function(e,j) {
                                        if (j < i) { return groups.nodes()[j].getBBox().width; } else return 0; }) + padding * i) + ",0)";
                                    })
                                                                
                            
                            
                            
                        </script>
                    </div>
                </div>
                <div class="tm-col tm-col-big">
                    <div class="bg-white tm-block h-100" >
                        <h2 class="tm-block-title">Portfolio Snapshot</h2>
                          <p> Select Date: <input type="text"id="dt"   class="column  month_and_year_option i " name="announcementdate" required placeholder="DD/MM/YYYY" autocomplete="off"></p>  
        
                        <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
                        <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.min.js"></script>
                        <link href="http://cdn-na.infragistics.com/igniteui/latest/css/themes/infragistics/infragistics.theme.css" rel="stylesheet">
                        <script>


                            var data={{data2|safe}}  

                            $(function(){
                                $( "#dt" ).datepicker({
                                    changeMonth : true,
                                    changeYear : true,
                                    dateFormat : 'dd/mm/yy'
                                });
                            });
                    
                            $(function(){
                                $("#dt").on("change",function(){
                                selected_date=$('#dt').val();
                                
                                table_data(selected_date)
                                })
                            });

                            function table_data(selected_date)
                                    {
                                    sort_data=data.filter((item) => item.Trade_Dt === selected_date )
                                    data2=sort_data;
                                    if(sort_data.length!=0)
                                    {
                                    console.log(JSON.stringify(data2))
                                    if(data2[0]['Annl Fund '])
                                    {
                                        document.getElementById("1").value=data2[0]['Annl Fund '];
                                    }
                                    else
                                    {
                                        document.getElementById("1").value=null;
                                    }
                            
                                    if(data2[0]['Annl Benchmark'])
                                    
                                        document.getElementById("2").value= parseFloat(data2[0]['Annl Benchmark']*100).toFixed(2)+"%"
                                    
                                    else 
                                        document.getElementById("2").value=null;

                            
                                    if(data2[0]["Ann'l Fund Vol"])
                                    
                                       
                                        document.getElementById("3").value=data2[0]["Ann'l Fund Vol"]
                                    
                                    else 
                                        document.getElementById("3").value=null;    


                                    if(data2[0]["Ann'l Benchmark Vol"])   
                                        document.getElementById("4").value=parseFloat(data2[0]["Ann'l Benchmark Vol"]*100).toFixed(2)+"%"
                                    else 
                                        document.getElementById("4").value=null;

                                    if(data2[0]['Max Drawdown - Fund'])
                                        document.getElementById("5").value =data2[0]['Max Drawdown - Fund']
                                    else 
                                        document.getElementById("5").value=null;

                                    if(data2[0]['Max Drawdown - Bench Mark'])
                                        document.getElementById("6").value=data2[0]['Max Drawdown - Bench Mark']
                                    else 
                                        document.getElementById("6").value=null;

                                    if(data2[0]['Sharpe - Fund'])
                                        document.getElementById("7").value =data2[0]['Sharpe - Fund']
                                    else 
                                        document.getElementById("7").value=null;

                                    if(data2[0]['Sharpe - Benchmark'])
                                            document.getElementById("8").value =data2[0]['Sharpe - Benchmark']
                                    else 
                                        document.getElementById("8").value=null;

                                    if(data2[0]['Sortino - Fund'])
                                        document.getElementById("9").value =data2[0]['Sortino - Fund']
                                    else 
                                        document.getElementById("9").value=null;

                                    if(data2[0]['Sortino - Benchmark'])
                                        document.getElementById("10").value=data2[0]['Sortino - Benchmark']
                                    else 
                                        document.getElementById("10").value=null;
                                        }
                                        else
                                        {
                                        //   alert("Data is not Available for that date !")
                                                    document.getElementById("1").value=null;
                                                    document.getElementById("2").value=null;
                                                    document.getElementById("3").value=null;    
                                                    document.getElementById("4").value=null;    
                                                    document.getElementById("5").value=null;    
                                                    document.getElementById("6").value=null;    
                                                    document.getElementById("7").value=null;    
                                                    document.getElementById("8").value=null;    
                                                    document.getElementById("9").value=null;    
                                                    document.getElementById("10").value=null; 
                                        }
                                    
                                    }

                        </script>


                        <!-------- Second Table in the First Page-->
                        <div style="overflow-x:auto;">
                        <table id='id_of_table' >
                            <tr>
                                <th> </th>
                                <th> Fund </th>
                                <th> S&P 500 </th>
                            </tr>
                    
                            <tr>
                                <td><b>Ann'l Return</b></td>
                                <td><input id="1" type="text"  readonly></td>
                                <td><input id="2" type="text" readonly></td>
                            </tr>
                        
                            <tr>
                                <td><b>Ann'l  Vol</b></td>
                                <td><input type="text" id="3" readonly></td>
                                <td><input id="4" type="text" readonly ></td>
                            </tr>
                
                        
                            <tr>
                                <td><b>Max Drawdown </b></td>
                                <td><input type="text" id="5" readonly></td>
                                <td><input id="6" type="text"readonly ></td>
                            </tr>
                            
                            <tr>
                                <td><b>Sharpe </b> </td>
                                <td><input type="text" id="7" readonly></td>
                                <td><input id="8" type="text" readonly></td>
                            </tr>
                            <tr>
                                <td><b>Sortino </b> </td>
                                <td><input type="text" id="9" readonly ></td>
                                <td><input id="10" type="text" readonly></td>
                            </tr>
                        </table>
                    </div>
                    </div>
                </div>
          

                <div class="tm-col tm-col-bbig">
                    <div class="bg-white tm-block h-100">
                            <h2 class="tm-block-title">Monthly Perfomance</h2>
                            <div>
                                    <!-- <div id="ytd_tab" style="float:left"></div> -->
                                <span id="insertfirsttable" style="float:left;width:80%"></span>
                            <table  id="ytd_table" style="float:right;">
                                <th>Year</th>
                                <th>YTD</th>
                                <tbody id="ytd"></tbody>     
                            </table>
               


                            <script>
                      
                                var ytd={{ytd|safe}}
                                var year={{year|safe}}
                                for(j=0;j<ytd.length;j++)
                                {
                                    var table = document.getElementById('ytd')
                            
                                    for (var r = 0; r < 1; r += 1) 
                                    {
                                        var x = document.getElementById('ytd').insertRow(r);
                                        for (var c = 0; c < 2; c += 1) {
                                        var y = x.insertCell(c);
                                       
                                        }
                            
                                        table.rows[r].cells[1].innerHTML = ytd[j];
                                        table.rows[r].cells[0].innerHTML = year[j];
                                    }
                                }
                                var margin = {top: 40, right: 0, bottom: 30, left: 170},
                                    width = 1240 - margin.left - margin.right,
                                    height = 205 - margin.top - margin.bottom;
                      
                                // append the svg object to the body of the page
                                var svg = d3.select("#insertfirsttable")
                                    .append("svg").attr("viewBox", [0, 0, width+200, height+100])
                                    .append("g")
                                    .attr("transform","translate(" + margin.left + "," + margin.top + ")");
                              
                                // Labels of row and columns
                                var myGroups =  ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]
                                var myVars = ["2017","2018","2019"]
                      
                                // Build X scales and axis:
                                var x = d3.scaleBand()
                                            .range([ 0, width ])
                                            .domain(myGroups)
                                            .padding(0.01);
                               x_axis=svg.append("g")
                                        .attr("transform", "translate(0," + height + ")").attr("class",'x_ticks')
                                        .call(d3.axisBottom(x))

                                x_axis.selectAll("text").style("fill","black").style("font-size","18")
                              

                                // Build X scales and axis:
                                var y = d3.scaleBand()
                                .range([ height, 0 ])
                                .domain(myVars)
                                .padding(0.01);

                                y_axis =svg.append("g")
                                            .attr("class", "y axis x_ticks")
                                            .call(d3.axisLeft(y));

                                y_axis.selectAll("text").style("fill","black").style("font-size","20")

                                
                            
                            // Build color scale
                            var myColor = d3.scaleLinear()
                              .range(["#FF7474", "#AAFE96"])
                              .domain([-0.05,0.05])
                            
                            //Read the data
                            d3.csv("../static/csv/page1_heatmap.csv", function(data) {
                              // var formatter = d3.format(".0%");
                              svg.selectAll()
                                  .data(data, function(d) {return d.Month+':'+d.Year;})
                                  .enter()
                                  .append("rect")
                                  .attr("x", function(d) { return x(d.Month) })
                                  .attr("y", function(d) { return y(d.Year) })
                                  .attr("width", x.bandwidth() )
                                  .attr("height", y.bandwidth() ) 
                           
                                  .style("fill", function(d) { return myColor(d.value)} )
                             
                                svg.selectAll()
                                  .data(data, function(d) {return d.Month+':'+d.Year;})
                                  .enter()
                                  .append("text")
                                  .attr("x", function(d) { return x(d.Month)+20})
                                  .attr("y", function(d) { return y(d.Year)+30})
                                  .attr("width", x.bandwidth() )
                                  .attr("height", y.bandwidth() )
                                  .style("fill","black")
                                  .style("font-size","12")
                                  .style("font-weight","bold")
                                  .text( function(d) {
                                    if(d.value) 
                                    {
                                      num=d.value*100;y=parseFloat(num).toFixed(2);return y+"%";
                                    }
                                    else
                                    return null;
                                    })
                                  
                                  
                      
                            })
        
                          
                                     
                            </script>
                            </div>
                    </div>
                </div>
            
              
           
            </div>
        </div>
    </div>
       
</body>
</body>
</html>
   <!-- ALL JS FILES -->
   <script src="{% static 'static/js/all.js' %}"></script>
   <!-- ALL PLUGINS -->
   <script src="{% static 'static/js/custom.js' %}"></script>